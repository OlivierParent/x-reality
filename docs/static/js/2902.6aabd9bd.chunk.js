"use strict";(self.webpackChunkx_reality=self.webpackChunkx_reality||[]).push([[2902],{3081:(e,t,n)=>{n.d(t,{P:()=>d});var r=n(7462),o=n(7313),a=n(5825),i=n(3002),s=n(4296),l=n(2362);class c extends a.ShaderMaterial{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new a.Vector3(0,0,0)},lightColor:{value:new a.Color("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new a.Vector2(0,0)}},transparent:!0,depthWrite:!1,vertexShader:"\n        varying vec3 vNormal;\n        varying float vViewZ;\n        varying float vIntensity;\n        uniform vec3 spotPosition;\n        uniform float attenuation;\n\n        #include <common>\n        #include <logdepthbuf_pars_vertex>\n\n        void main() {\n          // compute intensity\n          vNormal = normalize(normalMatrix * normal);\n          vec4 worldPosition = modelMatrix * vec4(position, 1);\n          vec4 viewPosition = viewMatrix * worldPosition;\n          vViewZ = viewPosition.z;\n\n          vIntensity = 1.0 - saturate(distance(worldPosition.xyz, spotPosition) / attenuation);\n\n          gl_Position = projectionMatrix * viewPosition;\n\n          #include <logdepthbuf_vertex>\n        }\n      ",fragmentShader:"\n        varying vec3 vNormal;\n        varying float vViewZ;\n        varying float vIntensity;\n\n        uniform vec3 lightColor;\n        uniform float anglePower;\n        uniform sampler2D depth;\n        uniform vec2 resolution;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float opacity;\n\n        #include <packing>\n        #include <logdepthbuf_pars_fragment>\n\n        float readDepth(sampler2D depthSampler, vec2 uv) {\n          float fragCoordZ = texture(depthSampler, uv).r;\n\n          // https://github.com/mrdoob/three.js/issues/23072\n          #ifdef USE_LOGDEPTHBUF\n            float viewZ = 1.0 - exp2(fragCoordZ * log(cameraFar + 1.0) / log(2.0));\n          #else\n            float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);\n          #endif\n\n          return viewZ;\n        }\n\n        void main() {\n          #include <logdepthbuf_fragment>\n\n          vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));\n          float angleIntensity = pow(dot(normal, vec3(0, 0, 1)), anglePower);\n          float intensity = vIntensity * angleIntensity;\n\n          // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry\n          bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;\n          if (isSoft) {\n            vec2 uv = gl_FragCoord.xy / resolution;\n            intensity *= smoothstep(0.0, 1.0, vViewZ - readDepth(depth, uv));\n          }\n\n          gl_FragColor = vec4(lightColor, intensity * opacity);\n\n          #include <tonemapping_fragment>\n          #include <".concat(l.i>=154?"colorspace_fragment":"encodings_fragment",">\n        }\n      ")})}}function u(e){let{opacity:t=1,radiusTop:n,radiusBottom:r,depthBuffer:s,color:l="white",distance:u=5,angle:d=.15,attenuation:p=5,anglePower:m=5}=e;const f=o.useRef(null),v=(0,i.A)((e=>e.size)),g=(0,i.A)((e=>e.camera)),h=(0,i.A)((e=>e.viewport.dpr)),[y]=o.useState((()=>new c)),[w]=o.useState((()=>new a.Vector3));n=void 0===n?.1:n,r=void 0===r?7*d:r,(0,i.C)((()=>{y.uniforms.spotPosition.value.copy(f.current.getWorldPosition(w)),f.current.lookAt(f.current.parent.target.getWorldPosition(w))}));const b=o.useMemo((()=>{const e=new a.CylinderGeometry(n,r,u,128,64,!0);return e.applyMatrix4((new a.Matrix4).makeTranslation(0,-u/2,0)),e.applyMatrix4((new a.Matrix4).makeRotationX(-Math.PI/2)),e}),[u,n,r]);return o.createElement(o.Fragment,null,o.createElement("mesh",{ref:f,geometry:b,raycast:()=>null},o.createElement("primitive",{object:y,attach:"material","uniforms-opacity-value":t,"uniforms-lightColor-value":l,"uniforms-attenuation-value":p,"uniforms-anglePower-value":m,"uniforms-depth-value":s,"uniforms-cameraNear-value":g.near,"uniforms-cameraFar-value":g.far,"uniforms-resolution-value":s?[v.width*h,v.height*h]:[0,0]})))}const d=o.forwardRef(((e,t)=>{let{opacity:n=1,radiusTop:a,radiusBottom:i,depthBuffer:l,color:c="white",distance:d=5,angle:p=.15,attenuation:m=5,anglePower:f=5,volumetric:v=!0,debug:g=!1,children:h,...y}=e;const w=o.useRef(null);return o.createElement("group",null,g&&w.current&&o.createElement("spotLightHelper",{args:[w.current]}),o.createElement("spotLight",(0,r.Z)({ref:(0,s.Z)([t,w]),angle:p,color:c,distance:d,castShadow:!0},y),v&&o.createElement(u,{debug:g,opacity:n,radiusTop:a,radiusBottom:i,depthBuffer:l,color:c,distance:d,angle:p,attenuation:m,anglePower:f})),h&&o.cloneElement(h,{spotlightRef:w,debug:g}))}))},2952:(e,t,n)=>{n.d(t,{Ab:()=>c,Cd:()=>s,FC:()=>g,FM:()=>v,JO:()=>d,KC:()=>p,N1:()=>y,Qq:()=>l,aL:()=>u,fg:()=>m,vO:()=>f,xu:()=>i,yI:()=>h});var r=n(7462),o=n(7313);function a(e,t){const n=e+"Geometry";return o.forwardRef(((e,a)=>{let{args:i,children:s,...l}=e;const c=o.useRef(null);return o.useImperativeHandle(a,(()=>c.current)),o.useLayoutEffect((()=>{null==t||t(c.current)})),o.createElement("mesh",(0,r.Z)({ref:c},l),o.createElement(n,{attach:"geometry",args:i}),s)}))}const i=a("box"),s=a("circle"),l=a("cone"),c=a("cylinder"),u=a("sphere"),d=a("plane"),p=a("torus"),m=a("torusKnot"),f=a("tetrahedron"),v=a("ring"),g=a("icosahedron"),h=a("octahedron"),y=a("dodecahedron")},5964:(e,t,n)=>{n.d(t,{H:()=>a});var r=n(7313),o=n(3002);function a(e,t){for(var n=arguments.length,a=new Array(n>2?n-2:0),i=2;i<n;i++)a[i-2]=arguments[i];const s=r.useRef(),l=(0,o.A)((e=>e.scene));return r.useLayoutEffect((()=>{let n;if(e&&null!=e&&e.current&&t&&(s.current=n=new t(e.current,...a)),n)return n.traverse((e=>e.raycast=()=>null)),l.add(n),()=>{s.current=void 0,l.remove(n),null==n.dispose||n.dispose()}}),[l,t,e,...a]),(0,o.C)((()=>{var e;null==(e=s.current)||null==e.update||e.update()})),s}},124:(e,t,n)=>{n.d(t,{K:()=>l});var r=n(7313),o=n(8640),a=n(1120);const i="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json",s="https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d";function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,n=arguments.length>2?arguments[2]:void 0;const l=(0,a.Rq)((()=>fetch(i).then((e=>e.json()))),["matcapList"]),c=l[0],u=r.useMemo((()=>Object.keys(l).length),[]),d=r.useMemo((()=>"string"===typeof e?e:"number"===typeof e?l[e]:null),[e]),p="".concat(d||c).concat(function(e){switch(e){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}(t),".png"),m="".concat(s,"/").concat(t,"/").concat(p);return[(0,o.m)(m,n),m,u]}},8640:(e,t,n)=>{n.d(t,{m:()=>s});var r=n(5825),o=n(3002),a=n(7313);const i=e=>e===Object(e)&&!Array.isArray(e)&&"function"!==typeof e;function s(e,t){const n=(0,o.A)((e=>e.gl)),s=(0,o.F)(r.TextureLoader,i(e)?Object.values(e):e);if((0,a.useLayoutEffect)((()=>{null==t||t(s)}),[t]),(0,a.useEffect)((()=>{if("initTexture"in n){(Array.isArray(s)?s:[s]).forEach(n.initTexture)}}),[n,s]),i(e)){const t={};let n=0;for(const r in e)t[r]=s[n++];return t}return s}s.preload=e=>o.F.preload(r.TextureLoader,e),s.clear=e=>o.F.clear(r.TextureLoader,e)},2362:(e,t,n)=>{n.d(t,{i:()=>o});var r=n(5825);const o=(()=>parseInt(r.REVISION.replace(/\D+/g,"")))()},9782:(e,t,n)=>{n.d(t,{Z:()=>l,c:()=>s});var r=n(7313),o=n(176),a=n(9009);const i=r.createContext(null);function s(e){let{map:t,children:n,onChange:s,domElement:l}=e;const c=t.map((e=>e.name+e.keys)).join("-"),u=r.useMemo((()=>(0,o.Z)((0,a.XR)((()=>t.reduce(((e,t)=>({...e,[t.name]:!1})),{}))))),[c]),d=r.useMemo((()=>[u.subscribe,u.getState,u]),[c]),p=u.setState;return r.useEffect((()=>{const e=t.map((e=>{let{name:t,keys:n,up:r}=e;return{keys:n,up:r,fn:e=>{p({[t]:e}),s&&s(t,e,d[1]())}}})).reduce(((e,t)=>{let{keys:n,fn:r,up:o=!0}=t;return n.forEach((t=>e[t]={fn:r,pressed:!1,up:o})),e}),{}),n=t=>{let{key:n,code:r}=t;const o=e[n]||e[r];if(!o)return;const{fn:a,pressed:i,up:s}=o;o.pressed=!0,!s&&i||a(!0)},r=t=>{let{key:n,code:r}=t;const o=e[n]||e[r];if(!o)return;const{fn:a,up:i}=o;o.pressed=!1,i&&a(!1)},o=l||window;return o.addEventListener("keydown",n,{passive:!0}),o.addEventListener("keyup",r,{passive:!0}),()=>{o.removeEventListener("keydown",n),o.removeEventListener("keyup",r)}}),[l,c]),r.createElement(i.Provider,{value:d,children:n})}function l(e){const[t,n,o]=r.useContext(i);return e?o(e):[t,n]}},2185:(e,t,n)=>{n.d(t,{h:()=>g});var r=n(7313),o=n(3082),a=n(5825),i=n(3002);const s=new a.Vector3,l=new a.Vector3,c=new a.Matrix3;class u extends a.LineSegments{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16711680;const r=new a.BufferGeometry,o=e.geometry.attributes.normal.count,i=new a.Float32BufferAttribute(2*o*3,3);r.setAttribute("position",i),super(r,new a.LineBasicMaterial({color:n,toneMapped:!1})),this.object=e,this.size=t,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),c.getNormalMatrix(this.object.matrixWorld);const e=this.object.matrixWorld,t=this.geometry.attributes.position,n=this.object.geometry;if(n){const r=n.attributes.position,o=n.attributes.normal;let a=0;for(let n=0,i=r.count;n<i;n++)s.fromBufferAttribute(r,n).applyMatrix4(e),l.fromBufferAttribute(o,n),l.applyMatrix3(c).normalize().multiplyScalar(this.size).add(s),t.setXYZ(a,s.x,s.y,s.z),a+=1,t.setXYZ(a,l.x,l.y,l.z),a+=1}t.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}const d=new a.Vector3,p=e=>{const{scene:t}=(0,i.A)(),n=(0,r.useRef)(),o=(0,r.useRef)(),s=e.strength>0?255:16711680;return(0,r.useEffect)((()=>(n.current=new a.Mesh(new a.SphereGeometry(.2,6,6),new a.MeshBasicMaterial({color:s,wireframe:!0})),o.current=new u(n.current,e.range,s),o.current.frustumCulled=!1,t.add(n.current),t.add(o.current),()=>{o.current&&n.current&&(t.remove(o.current),t.remove(n.current))})),[e,s]),(0,i.C)((()=>{if(n.current&&e.object.current){var t;const r=e.object.current.getWorldPosition(d);n.current.position.copy(r),null===(t=o.current)||void 0===t||t.update()}})),null},m={static:(e,t,n,r,o)=>e,linear:(e,t,n,r,o)=>e*(r/n),newtonian:(e,t,n,r,o)=>o*e*t/Math.pow(r,2)},f=new a.Vector3,v=new a.Vector3,g=(0,r.memo)((e=>{const{position:t=[0,0,0],strength:n=1,range:i=10,type:s="static",gravitationalConstant:l=6673e-14,collisionGroups:c}=e,u=(0,r.useRef)(null),{isDebug:d}=(0,o.dv)();return(0,o.DL)((e=>{u.current&&e.bodies.forEach((e=>{e.isDynamic()&&((e,t)=>{let{object:n,strength:r,range:o,gravitationalConstant:i,collisionGroups:s,type:l}=t;const c=e.translation();f.set(c.x,c.y,c.z);const u=n.getWorldPosition(new a.Vector3),d=u.distanceTo(f);if(d<o){let t=m[l](r,e.mass(),o,d,i);t=t===1/0?r:t;let n=void 0===s;if(void 0!==s)for(let r=0;r<e.numColliders();r++){const t=e.collider(r).collisionGroups();if(0!=(s>>16&t)&&0!=(t>>16&s)){n=!0;break}}n&&(v.set(0,0,0).subVectors(u,f).normalize().multiplyScalar(t),e.applyImpulse(v,!0))}})(e,{object:u.current,strength:n,range:i,type:s,gravitationalConstant:l,collisionGroups:c})}))})),r.createElement(r.Fragment,null,r.createElement("object3D",{ref:u,position:t}),d&&r.createElement(p,{strength:n,gravitationalConstant:l,range:i,type:s,collisionGroups:c,object:u}))}))}}]);