"use strict";(self.webpackChunkx_reality=self.webpackChunkx_reality||[]).push([[4829],{9363:(e,o,r)=>{let t;r.d(o,{n:()=>t}),function(e){let o=function(e){return e.playerJump="playerJump",e.playerMoveBackward="playerMoveBackward",e.playerMoveForward="playerMoveForward",e.playerMoveLeft="playerMoveLeft",e.playerMoveRight="playerMoveRight",e.playerRun="playerRun",e.pinballFlipperBoth="pinballFlipperBoth",e.pinballFlipperLeft="pinballFlipperLeft",e.pinballFlipperRight="pinballFlipperRight",e.pinballShoot="pinballShoot",e}({}),r=function(e){return e.A="KeyA",e.D="KeyD",e.DOWN="ArrowDown",e.E="KeyE",e.F="KeyF",e.J="KeyJ",e.LEFT="ArrowLeft",e.Q="KeyQ",e.ENTER="Enter",e.RIGHT="ArrowRight",e.S="KeyS",e.SHIFT="Shift",e.SPACE="Space",e.UP="ArrowUp",e.W="KeyW",e.Z="KeyZ",e}({});const t=[{name:o.playerMoveBackward,keys:[r.DOWN,r.D]},{name:o.playerMoveForward,keys:[r.UP,r.E]},{name:o.playerMoveLeft,keys:[r.LEFT,r.S]},{name:o.playerMoveRight,keys:[r.RIGHT,r.F]}],n=[{name:o.playerJump,keys:[r.SPACE]},{name:o.playerRun,keys:[r.SHIFT]}],s=[{name:o.playerMoveBackward,keys:[r.DOWN,r.S]},{name:o.playerMoveForward,keys:[r.UP,r.W]},{name:o.playerMoveLeft,keys:[r.LEFT,r.A]},{name:o.playerMoveRight,keys:[r.RIGHT,r.D]}],i=[{name:o.playerMoveBackward,keys:[r.DOWN,r.S]},{name:o.playerMoveForward,keys:[r.UP,r.Z]},{name:o.playerMoveLeft,keys:[r.LEFT,r.Q]},{name:o.playerMoveRight,keys:[r.RIGHT,r.D]}];e.CONFIG_FIRST_PERSON_AZERTY=[...i,...n],e.CONFIG_FIRST_PERSON_UNIVERSAL=[...t,...n],e.CONFIG_FIRST_PERSON_QWERTY=[...s,...n],e.CONFIG_PINBALL_MACHINE=[{name:o.pinballFlipperBoth,keys:[r.SPACE]},{name:o.pinballFlipperLeft,keys:[r.F]},{name:o.pinballFlipperRight,keys:[r.J]},{name:o.pinballShoot,keys:[r.ENTER]}]}(t||(t={}))},3280:(e,o,r)=>{r.d(o,{p:()=>l});var t=r(4704),n=r(5397),s=r(9817);let i;var a;function l(){const{gravity:e,paused:o,showDebug:r}=(0,t.M4)(n.O.SCHEMA.PHYSICS,{gravity:i.gravity(),paused:i.paused(),showDebug:i.showDebug(!0)},s.F.folder(n.O.ORDER.PHYSICS));return{gravity:e,paused:o,showDebug:r}}(a=i||(i={})).gravity=function(){return{label:"Gravity",hint:"Default = 9.81",value:{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:-9.80665,z:arguments.length>2&&void 0!==arguments[2]?arguments[2]:0}}},a.paused=function(){return{label:"Paused",hint:"Pause physics simulation.",value:arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},a.showDebug=function(){return{label:"Debug",hint:"Show debug geometry.",value:arguments.length>0&&void 0!==arguments[0]&&arguments[0]}}},5198:(e,o,r)=>{let t;r.d(o,{r:()=>t}),function(e){let o=function(e){return e.BLACK_IRON="2D2D2A_74716E_8F8C8C_92958E",e.BUFFED_SILVER="54584E_B1BAC5_818B91_A7ACA3",e.GRAPHITE="2D2D2F_C6C2C5_727176_94949B",e.GREEN_CRYSTAL="2E763A_78A0B7_B3D1CF_14F209",e.SILVERY="4C4C4C_D2D2D2_8F8F8F_ACACAC",e.TITANIUM="C7C7D7_4C4E5A_818393_6C6C74",e.WORN_GOLD="6E5137_E8CA90_271912_B99C74",e}({});e.ID=o;let r=function(e){return e[e.XS=64]="XS",e[e.SM=128]="SM",e[e.MD=256]="MD",e[e.LG=512]="LG",e[e.XL=1024]="XL",e}({});e.SIZE=r}(t||(t={}))},4829:(e,o,r)=>{r.r(o),r.d(o,{default:()=>Ie});var t=r(3002),n=r(3082),s=r(4704),i=r(7313),a=r(5825);let l=function(e){return e[e.BALL=0]="BALL",e[e.BUMPER=1]="BUMPER",e[e.CABINET=2]="CABINET",e[e.CONSTRAINT=3]="CONSTRAINT",e[e.FLIPPER=4]="FLIPPER",e[e.KICKER=5]="KICKER",e[e.PLUNGER=6]="PLUNGER",e[e.SENSOR=7]="SENSOR",e[e.WALL=8]="WALL",e}({});var p=r(5397);const c=new class{constructor(){this._score=void 0,this._score=0}get score(){return this._score}set score(e){this._score=e}add(e){this._score+=Math.abs(e)}},I=(0,i.createContext)(c);var u=r(2952),E=r(2185),R=r(6417);const T=new a.Vector3(0,0,-5),L=.6,d={HEIGHT:8,WIDTH:8},h=()=>(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(E.h,{collisionGroups:void 0,position:T,range:.5,strength:.02,type:"linear"}),(0,R.jsx)(u.aL,{args:[L,d.WIDTH,d.HEIGHT],position:T,children:(0,R.jsx)("meshBasicMaterial",{color:16711935,opacity:.5,transparent:!0})})]});var A=r(124),S=r(5198);const O=(0,i.forwardRef)(((e,o)=>{const{color:r=16777215,position:t,radius:s=.125}=e,[i]=(0,A.K)(S.r.ID.TITANIUM,S.r.SIZE.XL);return(0,R.jsx)(n.ib,{canSleep:!1,colliders:"ball",collisionGroups:(0,n.bI)(l.BALL,[l.BALL,l.BUMPER,l.FLIPPER,l.KICKER,l.PLUNGER,l.SENSOR,l.WALL]),density:1,friction:void 0,position:t,ref:o,restitution:0,type:"dynamic",solverGroups:(0,n.bI)(l.BALL,[l.BALL,l.BUMPER,l.FLIPPER,l.KICKER,l.PLUNGER,l.WALL]),children:(0,R.jsx)(u.aL,{args:[s],children:(0,R.jsx)("meshMatcapMaterial",{color:r,matcap:i})})})})),x={CENTER:.001,EXTREMITY:1},N=7,m=-10,M={LEFT:{COLOR:"hsl(0, 100%, 75%)",POSITION:new a.Vector3(-x.EXTREMITY*(Math.random()+.5),N,m)},MIDDLE:{COLOR:"hsl(120, 100%, 75%)",POSITION:new a.Vector3(x.CENTER*(2*Math.random()-1),N,m-.5)},RADIUS:.125,RIGHT:{COLOR:"hsl(240, 100%, 75%)",POSITION:new a.Vector3(x.EXTREMITY*(Math.random()+.5),N,m)}},y={ACTIVE:"green",INACTIVE:"yellow"},f=.25,g={BOTTOM:.1,TOP:.2},C=e=>{const{position:o=new a.Vector3(0,0,0)}=e,r=(0,i.useRef)(null);return(0,R.jsx)("group",{name:"Bumper",position:o,children:(0,R.jsxs)(n.ib,{colliders:!1,position:new a.Vector3(0,f/2,0),restitution:2.5,type:"fixed",children:[(0,R.jsx)(n.Y_,{args:[f/2,(g.BOTTOM+g.TOP)/2],onCollisionEnter:()=>{r.current.color.set(y.ACTIVE)},onCollisionExit:()=>{setTimeout((()=>{r.current.color.set(y.INACTIVE)}),500)},collisionGroups:(0,n.bI)(l.BUMPER,l.BALL),solverGroups:(0,n.bI)(l.BUMPER,l.BALL)}),(0,R.jsx)(u.Ab,{args:[g.TOP,g.BOTTOM,f],children:(0,R.jsx)("meshBasicMaterial",{color:y.INACTIVE,opacity:.5,ref:r,transparent:!0})})]})})},P=.25,j=.3,b=new a.MeshBasicMaterial,w=new a.MeshBasicMaterial,G=new a.MeshBasicMaterial;b.color.setHSL(0,1,.5),w.color.setHSL(2/3,1,.5),G.color.setHSL(1/3,1,.5);const D=e=>(0,R.jsx)("group",{name:"Cabinet Walls",...e,children:(0,R.jsxs)(n.ib,{restitution:3,type:"fixed",collisionGroups:(0,n.bI)(l.WALL,[l.BALL]),solverGroups:(0,n.bI)(l.WALL,[l.BALL]),children:[(0,R.jsx)(u.xu,{args:[10,j,P],material:w,name:"Side Wall Top",position:new a.Vector3(0,j/2,-14)}),(0,R.jsx)(u.xu,{args:[16,j,P],material:b,name:"Side Wall Left",position:new a.Vector3(-5,j/2,-6),rotation:[0,Math.PI/2,0]}),(0,R.jsx)(u.xu,{args:[16,j,P],material:G,name:"Side Wall Right",position:new a.Vector3(5,j/2,-6),rotation:[0,-Math.PI/2,0]}),(0,R.jsx)(u.xu,{args:[3,j,P],material:b,name:"Side Wall Bottom Left",position:new a.Vector3(-2.4,j/2,-.55),rotation:[0,-Math.PI/9,0]}),(0,R.jsx)(u.xu,{args:[3,j,P],material:G,name:"Side Wall Bottom Right",position:new a.Vector3(2.4,j/2,-.55),rotation:[0,Math.PI/9,0]})]})});var v=r(9782);const F=.25,B=new a.Vector3(0,0,.01);var _=function(e){return e[e.RED=16711680]="RED",e[e.GREEN=65280]="GREEN",e[e.BLUE=255]="BLUE",e}(_||{});const H=e=>{const{orientation:o,position:r=new a.Vector3(0,0,0)}=e,s=(0,v.Z)((e=>e.pinballFlipperBoth)),p=(0,v.Z)((e=>e.pinballFlipperLeft)),c=(0,v.Z)((e=>e.pinballFlipperRight)),I="left"===o,E=s||(I?p:c),T=E?_.BLUE:I?_.RED:_.GREEN,L=a.MathUtils.degToRad(40*(I?-1:1)),d=.8*(I?1:-1),h=(0,i.useRef)(null),A=(0,i.useRef)(null),S=(0,i.useRef)(null),O=[[0,0,0],[0,0,0],[0,1,0]];(0,n.UP)(A,S,O);const x=(0,i.useMemo)((()=>new a.Vector3(d+10*(I?-1:1),.25,.3)),[I,d]);return(0,t.C)(((e,o)=>{E&&A.current.applyImpulseAtPoint(B,x,!0)})),(0,R.jsxs)("group",{name:"Flipper",position:r,children:[(0,R.jsx)(n.ib,{canSleep:!1,colliders:"cuboid",collisionGroups:(0,n.bI)(l.FLIPPER,[l.BALL,l.CONSTRAINT]),mass:1e5,name:"Flipper",ref:A,restitution:3,rotation:new a.Euler(0,L,0),type:"dynamic",solverGroups:(0,n.bI)(l.FLIPPER,[l.BALL,l.CONSTRAINT]),children:(0,R.jsxs)("mesh",{ref:h,position:new a.Vector3(d/2,.225,0),children:[(0,R.jsx)("boxGeometry",{args:[1,.25,.3]}),(0,R.jsx)("meshStandardMaterial",{color:T,transparent:!1})]})}),(0,R.jsx)(n.ib,{name:"Fixation",ref:S,type:"fixed",children:(0,R.jsx)(u.xu,{args:[.0625,.0625,.0625]})}),(0,R.jsxs)(n.ib,{name:"Constraints",type:"fixed",children:[(0,R.jsx)(n.dp,{args:[.1],collisionGroups:(0,n.bI)(l.CONSTRAINT),name:"Upper Constraint",position:[(.8-.1)*(I?1:-1),.225,0],restitution:-999}),(0,R.jsx)(n.dp,{args:[.1],collisionGroups:(0,n.bI)(l.CONSTRAINT),name:"Lower Constraint",position:[(.8-.5)*(I?1:-1),.225,.7],restitution:-999})]}),(0,R.jsx)(u.aL,{name:"Impulse point visualisation",args:[F,4,4],position:x,children:(0,R.jsx)("meshBasicMaterial",{color:_.BLUE,wireframe:!0})})]})},U={LEFT:{COLOR:"hsl(0, 100%, 75%)",ORIENTATION:"left",POSITION:new a.Vector3(-1,0,0)},RIGHT:{COLOR:"hsl(240, 100%, 75%)",ORIENTATION:"right",POSITION:new a.Vector3(1,0,0)}},V=10,k=16,W={WIDTH:V/2,HEIGHT:.125/2,DEPTH:k/2},K=()=>(0,R.jsxs)(n.ib,{type:"fixed",children:[(0,R.jsx)(u.JO,{args:[V,k],rotation:new a.Euler(a.MathUtils.degToRad(-90),0,0),position:new a.Vector3(0,0,-6)}),(0,R.jsx)(n.jc,{args:[W.WIDTH,W.HEIGHT,W.DEPTH],restitution:.25,position:new a.Vector3(0,0,-6)})]}),X=30*M.RADIUS,Z={PLUNGER:{RADIUS:M.RADIUS/2,LENGTH:X},RAIL:{LENGTH:2*X/3,DIAMETER:2*M.RADIUS}},Y=new a.Vector3,J=e=>{const[o]=(0,A.K)(S.r.ID.TITANIUM,S.r.SIZE.XL),{position:r=Y}=e,t=(0,v.Z)((e=>e.pinballShoot)),s=(0,i.useRef)(null),p=(0,i.useRef)(null),c=(0,i.useRef)(null),I=[0,0,0],E=[0,0,0],T=[0,0,1],L=[-.1,.1];return(0,n.RU)(s,p,[I,E,T,L]),(0,n.RU)(s,c,[I,E,T,L]),(0,i.useEffect)((()=>{s.current.addForce(new a.Vector3(0,0,9.81),!0)}),[]),(0,i.useEffect)((()=>{console.info("shootOn:",t),t&&s.current.applyImpulse({x:0,y:0,z:-5},!0)}),[t]),(0,R.jsxs)("group",{name:"Plunger",position:r,children:[(0,R.jsxs)(n.ib,{collisionGroups:(0,n.bI)(l.WALL,[l.BALL]),solverGroups:(0,n.bI)(l.WALL,[l.BALL]),type:"fixed",children:[(0,R.jsx)(u.xu,{args:[Z.RAIL.DIAMETER,Z.RAIL.DIAMETER,Z.RAIL.LENGTH],position:[-(Z.RAIL.DIAMETER+.01),Z.RAIL.DIAMETER/2,-Z.PLUNGER.LENGTH/4],children:(0,R.jsx)("meshMatcapMaterial",{matcap:o})}),(0,R.jsx)(u.xu,{args:[Z.RAIL.DIAMETER,Z.RAIL.DIAMETER,Z.RAIL.LENGTH],position:[Z.RAIL.DIAMETER+.01,Z.RAIL.DIAMETER/2,-Z.PLUNGER.LENGTH/4],children:(0,R.jsx)("meshMatcapMaterial",{matcap:o})})]}),(0,R.jsxs)("group",{position:new a.Vector3(0,.01,0),children:[(0,R.jsx)(n.ib,{friction:0,mass:1e3,name:"Plunger",ref:s,type:"dynamic",collisionGroups:(0,n.bI)(l.PLUNGER,[l.BALL]),solverGroups:(0,n.bI)(l.PLUNGER,[l.BALL]),children:(0,R.jsx)(u.Ab,{args:[Z.PLUNGER.RADIUS,Z.PLUNGER.RADIUS,Z.PLUNGER.LENGTH,32],rotation:new a.Euler(Math.PI/2,0,0),children:(0,R.jsx)("meshMatcapMaterial",{matcap:o,color:t?"blue":"white"})})}),(0,R.jsx)(n.ib,{collisionGroups:(0,n.bI)(l.CONSTRAINT,[]),name:"Constraint A",position:[0,0,-2],ref:p,solverGroups:(0,n.bI)(l.CONSTRAINT,[]),type:"fixed",children:(0,R.jsx)(u.xu,{args:[.1,.1,1]})}),(0,R.jsx)(n.ib,{collisionGroups:(0,n.bI)(l.CONSTRAINT,[]),name:"Constraint B",position:[0,0,2],ref:c,solverGroups:(0,n.bI)(l.CONSTRAINT,[]),type:"fixed",children:(0,R.jsx)(u.xu,{args:[.1,.1,1]})})]})]})},Q={POSITION:new a.Vector3(0,3,5),TARGET:new a.Vector3(0,0,-2)},z=new a.Quaternion,q=new a.Vector3;function $(e,o){e.current.setAngvel(q,!0),e.current.setLinvel(q,!0),e.current.setRotation(z,!0),e.current.setTranslation(o,!0)}var ee=function(e){return e.RESTORE_SNAPSHOT="Restore Snapshot",e.STORE_SNAPSHOT="Store Snapshot",e.RESET="Reset",e}(ee||{});const oe=new a.Euler(a.MathUtils.degToRad(20),0,0),re=e=>{(0,s.M4)(p.O.SCHEMA.SIMULATION,{[ee.STORE_SNAPSHOT]:(0,s.LI)((()=>m())),[ee.RESTORE_SNAPSHOT]:(0,s.LI)((()=>N())),[ee.RESET]:(0,s.LI)((()=>S()))},{order:p.O.ORDER.SIMULATION});const o=(0,i.useContext)(I),r=(0,n.dv)(),{camera:c}=(0,t.A)(),u=(0,i.useRef)(null),E=(0,i.useRef)(null),T=(0,i.useRef)(null),L=(0,i.useRef)(null),[d,A]=(0,i.useState)(0),S=(0,i.useCallback)((()=>{console.info("Rapier: resetting..."),M.LEFT.POSITION.setX(-x.EXTREMITY*(Math.random()+.5)),M.MIDDLE.POSITION.setX(x.CENTER*(2*Math.random()-1)),M.RIGHT.POSITION.setX(x.EXTREMITY*(Math.random()+.5)),$(u,M.LEFT.POSITION),$(E,M.MIDDLE.POSITION),$(T,M.RIGHT.POSITION)}),[]),N=(0,i.useCallback)((()=>{console.info("Rapier: restoring snapshot...");const e=r.rapier.World.restoreSnapshot(L.current);r.setWorld(e)}),[r]),m=(0,i.useCallback)((()=>{console.info("Rapier: taking snapshot...");const e=r.world.takeSnapshot();L.current=e}),[r]);return(0,i.useEffect)((()=>{c.position.set(...Q.POSITION.toArray()),c.lookAt(...Q.TARGET.toArray())}),[c]),(0,i.useEffect)((()=>{console.info("Rapier: counter",d),3<=d&&(setTimeout((()=>{console.info("Rapier: calling reset."),S()}),2e3),A(0))}),[d,S]),(0,i.useEffect)((()=>{setTimeout((()=>{m()}),250)}),[m]),(0,t.C)(((e,r)=>{o.add(Math.floor(2*Math.random()))})),(0,R.jsxs)("group",{name:"Pinball Machine Game",...e,children:[(0,R.jsxs)("group",{name:"Tilt",rotation:oe,children:[(0,R.jsxs)("group",{name:"Cabinet",children:[(0,R.jsx)(K,{}),(0,R.jsx)(D,{}),(0,R.jsx)(n.ib,{type:"fixed",children:(0,R.jsx)(n.jc,{args:[4.7,.125,.125],collisionGroups:(0,n.bI)(l.SENSOR,[l.BALL]),onCollisionExit:()=>{console.info("Rapier: collision detected!"),A((e=>e+1))},position:new a.Vector3(0,.125,2),sensor:!0})})]}),(0,R.jsx)("group",{name:"Attractor",children:(0,R.jsx)(h,{})}),(0,R.jsxs)("group",{name:"Bumpers",children:[(0,R.jsx)(C,{position:new a.Vector3(0,0,-2)}),(0,R.jsx)(C,{position:new a.Vector3(-3,0,-5)}),(0,R.jsx)(C,{position:new a.Vector3(3,0,-5)})]}),(0,R.jsx)("group",{name:"Flippers",children:(0,R.jsxs)("group",{position:new a.Vector3(0,0,0),children:[(0,R.jsx)(H,{orientation:U.LEFT.ORIENTATION,position:U.LEFT.POSITION}),(0,R.jsx)(H,{orientation:U.RIGHT.ORIENTATION,position:U.RIGHT.POSITION})]})}),(0,R.jsxs)("group",{name:"Plunger Assembly",position:[4.7,0,1.6],children:[(0,R.jsx)(O,{color:"cyan",position:new a.Vector3(0,3,-5)}),(0,R.jsx)(J,{position:new a.Vector3(0,0,0)})]})]}),(0,R.jsxs)("group",{name:"Balls",children:[(0,R.jsx)(O,{color:M.LEFT.COLOR,position:M.LEFT.POSITION,ref:u}),(0,R.jsx)(O,{color:M.MIDDLE.COLOR,position:M.MIDDLE.POSITION,ref:E}),(0,R.jsx)(O,{color:M.RIGHT.COLOR,position:M.RIGHT.POSITION,ref:T})]})]})};var te=r(7066),ne=r(5819),se=r(1724),ie=r(7862),ae=r(9363),le=r(4662),pe=r(3280);const ce=e=>{let{children:o}=e;const r=(0,le.p)(),t=(0,pe.p)();return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(ne.Xz,{camera:void 0,flat:r.flat,frameloop:r.frameloop,linear:r.linear,orthographic:!1,shadows:r.shadows,children:(0,R.jsxs)(i.Suspense,{children:[(0,R.jsx)(se.Z,{}),(0,R.jsx)(ie.u,{}),(0,R.jsx)(v.c,{map:ae.n.CONFIG_PINBALL_MACHINE,children:(0,R.jsx)(n.wI,{colliders:void 0,debug:t.showDebug,gravity:[t.gravity.x,t.gravity.y,t.gravity.z],paused:t.paused,timeStep:"vary",updatePriority:void 0,children:o})})]})}),(0,R.jsx)(s.Zf,{collapsed:!1,fill:!1,flat:!1,hidden:!1,oneLineLabels:!0,titleBar:!0}),(0,R.jsx)(te.a,{})]})},Ie=e=>(0,R.jsx)(ce,{children:(0,R.jsx)(re,{...e})})}}]);